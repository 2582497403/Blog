<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fanqie.blog.dao.TbArticleDao">

    <resultMap type="com.fanqie.blog.entity.TbArticle" id="TbArticleMap">
        <result property="id" column="id" jdbcType="INTEGER"/>
        <result property="title" column="title" jdbcType="VARCHAR"/>
        <result property="slug" column="slug" jdbcType="VARCHAR"/>
        <result property="content" column="content" jdbcType="VARCHAR"/>
        <result property="summary" column="summary" jdbcType="VARCHAR"/>
        <result property="categoryId" column="category_id" jdbcType="INTEGER"/>
        <result property="authorId" column="author_id" jdbcType="INTEGER"/>
        <result property="views" column="views" jdbcType="INTEGER"/>
        <result property="status" column="status" jdbcType="VARCHAR"/>
        <result property="createdAt" column="created_at" jdbcType="TIMESTAMP"/>
        <result property="updatedAt" column="updated_at" jdbcType="TIMESTAMP"/>
        <result property="publishedAt" column="published_at" jdbcType="TIMESTAMP"/>
        <result property="thumbnail" column="thumbnail" jdbcType="VARCHAR"/>
        <result property="isFeatured" column="is_featured" jdbcType="BOOLEAN"/>
        <result property="isDeleted" column="is_deleted" jdbcType="BOOLEAN"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="TbArticleMap">
        select id,
               title,
               slug,
               content,
               summary,
               category_id,
               author_id,
               views,
               status,
               created_at,
               updated_at,
               published_at,
               thumbnail,
               is_featured,
               is_deleted
        from tb_article
        where id = #{id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="TbArticleMap">
        select
        id, title, slug, content, summary, category_id, author_id, views, status, created_at, updated_at, published_at,
        thumbnail, is_featured, is_deleted
        from tb_article
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="title != null and title != ''">
                and title = #{title}
            </if>
            <if test="slug != null and slug != ''">
                and slug = #{slug}
            </if>
            <if test="content != null and content != ''">
                and content = #{content}
            </if>
            <if test="summary != null and summary != ''">
                and summary = #{summary}
            </if>
            <if test="categoryId != null">
                and category_id = #{categoryId}
            </if>
            <if test="authorId != null">
                and author_id = #{authorId}
            </if>
            <if test="views != null">
                and views = #{views}
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="createdAt != null">
                and created_at = #{createdAt}
            </if>
            <if test="updatedAt != null">
                and updated_at = #{updatedAt}
            </if>
            <if test="publishedAt != null">
                and published_at = #{publishedAt}
            </if>
            <if test="thumbnail != null and thumbnail != ''">
                and thumbnail = #{thumbnail}
            </if>
            <if test="isFeatured != null">
                and is_featured = #{isFeatured}
            </if>
            <if test="isDeleted != null">
                and is_deleted = #{isDeleted}
            </if>
        </where>
        limit #{pageable.offset}, #{pageable.pageSize}
    </select>

    <!--统计总行数-->
    <select id="count" resultType="java.lang.Long">
        select count(1)
        from tb_article
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="title != null and title != ''">
                and title = #{title}
            </if>
            <if test="slug != null and slug != ''">
                and slug = #{slug}
            </if>
            <if test="content != null and content != ''">
                and content = #{content}
            </if>
            <if test="summary != null and summary != ''">
                and summary = #{summary}
            </if>
            <if test="categoryId != null">
                and category_id = #{categoryId}
            </if>
            <if test="authorId != null">
                and author_id = #{authorId}
            </if>
            <if test="views != null">
                and views = #{views}
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="createdAt != null">
                and created_at = #{createdAt}
            </if>
            <if test="updatedAt != null">
                and updated_at = #{updatedAt}
            </if>
            <if test="publishedAt != null">
                and published_at = #{publishedAt}
            </if>
            <if test="thumbnail != null and thumbnail != ''">
                and thumbnail = #{thumbnail}
            </if>
            <if test="isFeatured != null">
                and is_featured = #{isFeatured}
            </if>
            <if test="isDeleted != null">
                and is_deleted = #{isDeleted}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into tb_article(title, slug, content, summary, category_id, author_id, views, status, created_at,
                               updated_at, published_at, thumbnail, is_featured, is_deleted)
        values (#{title}, #{slug}, #{content}, #{summary}, #{categoryId}, #{authorId}, #{views}, #{status},
                #{createdAt}, #{updatedAt}, #{publishedAt}, #{thumbnail}, #{isFeatured}, #{isDeleted})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into tb_article(title, slug, content, summary, category_id, author_id, views, status, created_at,
        updated_at, published_at, thumbnail, is_featured, is_deleted)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.title}, #{entity.slug}, #{entity.content}, #{entity.summary}, #{entity.categoryId},
            #{entity.authorId}, #{entity.views}, #{entity.status}, #{entity.createdAt}, #{entity.updatedAt},
            #{entity.publishedAt}, #{entity.thumbnail}, #{entity.isFeatured}, #{entity.isDeleted})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into tb_article(title, slug, content, summary, category_id, author_id, views, status, created_at,
        updated_at, published_at, thumbnail, is_featured, is_deleted)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.title}, #{entity.slug}, #{entity.content}, #{entity.summary}, #{entity.categoryId},
            #{entity.authorId}, #{entity.views}, #{entity.status}, #{entity.createdAt}, #{entity.updatedAt},
            #{entity.publishedAt}, #{entity.thumbnail}, #{entity.isFeatured}, #{entity.isDeleted})
        </foreach>
        on duplicate key update
        title = values(title),
        slug = values(slug),
        content = values(content),
        summary = values(summary),
        category_id = values(category_id),
        author_id = values(author_id),
        views = values(views),
        status = values(status),
        created_at = values(created_at),
        updated_at = values(updated_at),
        published_at = values(published_at),
        thumbnail = values(thumbnail),
        is_featured = values(is_featured),
        is_deleted = values(is_deleted)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update tb_article
        <set>
            <if test="title != null and title != ''">
                title = #{title},
            </if>
            <if test="slug != null and slug != ''">
                slug = #{slug},
            </if>
            <if test="content != null and content != ''">
                content = #{content},
            </if>
            <if test="summary != null and summary != ''">
                summary = #{summary},
            </if>
            <if test="categoryId != null">
                category_id = #{categoryId},
            </if>
            <if test="authorId != null">
                author_id = #{authorId},
            </if>
            <if test="views != null">
                views = #{views},
            </if>
            <if test="status != null and status != ''">
                status = #{status},
            </if>
            <if test="createdAt != null">
                created_at = #{createdAt},
            </if>
            <if test="updatedAt != null">
                updated_at = #{updatedAt},
            </if>
            <if test="publishedAt != null">
                published_at = #{publishedAt},
            </if>
            <if test="thumbnail != null and thumbnail != ''">
                thumbnail = #{thumbnail},
            </if>
            <if test="isFeatured != null">
                is_featured = #{isFeatured},
            </if>
            <if test="isDeleted != null">
                is_deleted = #{isDeleted},
            </if>
        </set>
        where id = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete
        from tb_article
        where id = #{id}
    </delete>

</mapper>

